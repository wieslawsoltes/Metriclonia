<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="clr-namespace:Metriclonia.Monitor.Controls"
        xmlns:viz="clr-namespace:Metriclonia.Monitor.Visualization"
        mc:Ignorable="d" d:DesignWidth="1280" d:DesignHeight="720"
        x:Class="Metriclonia.Monitor.MainWindow"
        Title="Metriclonia Monitor" MinWidth="1024" MinHeight="720"
        x:CompileBindings="False">
    <DockPanel>
        <Border DockPanel.Dock="Top" Padding="12" Background="{DynamicResource ThemeControlMidBrush}">
            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="24">
                <StackPanel Orientation="Horizontal" Spacing="16">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <TextBlock Text="Listening" FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding ListeningPort}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <TextBlock Text="Ingress" FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding IngressRate, StringFormat=\{0:0.0\}/s}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <TextBlock Text="Series" FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding Series.Count}"/>
                    </StackPanel>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <TextBlock Text="Window" FontWeight="SemiBold"/>
                    <Slider Minimum="5" Maximum="180" Value="{Binding VisibleDurationSeconds}" Width="200"/>
                    <TextBlock Text="{Binding VisibleDurationSeconds, StringFormat=\{0:0\} s}"/>
                    <CheckBox Content="Pause capture" IsChecked="{Binding IsRenderingPaused}" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <TabControl Margin="0,12,0,0">
            <TabItem Header="Metrics">
                <Grid ColumnDefinitions="280,6,*">
                    <Border Grid.Column="0" Background="{DynamicResource ThemeControlLowBrush}" Padding="12">
                        <Grid RowDefinitions="Auto,*">
                            <TextBlock Grid.Row="0" Text="Active Metrics" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,12"/>
                            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                                <ItemsControl ItemsSource="{Binding Series}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Padding="12" Margin="0,0,0,8" Background="{DynamicResource ThemeBackgroundBrush}" CornerRadius="8">
                                                <StackPanel Spacing="6">
                                                    <CheckBox IsChecked="{Binding IsVisible}" Content="{Binding DisplayName}" Foreground="{Binding Stroke}" FontWeight="SemiBold">
                                                        <ToolTip.Tip>
                                                            <StackPanel>
                                                                <TextBlock Text="{Binding MeterName}" FontWeight="SemiBold"/>
                                                                <TextBlock Text="{Binding InstrumentName}"/>
                                                                <TextBlock Text="{Binding TagSignature, FallbackValue=No tags}" FontSize="11"/>
                                                            </StackPanel>
                                                        </ToolTip.Tip>
                                                    </CheckBox>
                                                    <TextBlock Text="{Binding Description}" FontSize="11" Foreground="Gray" TextWrapping="Wrap"/>
                                                    <UniformGrid Columns="2" Rows="2" ColumnSpacing="12" RowSpacing="6">
                                                        <StackPanel>
                                                            <TextBlock Text="Latest" FontSize="11" Foreground="Gray"/>
                                                            <TextBlock Text="{Binding LatestValue, StringFormat=\{0:0.00\}}" FontWeight="SemiBold"/>
                                                        </StackPanel>
                                                        <StackPanel>
                                                            <TextBlock Text="Average" FontSize="11" Foreground="Gray"/>
                                                            <TextBlock Text="{Binding Average, StringFormat=\{0:0.00\}}" FontWeight="SemiBold"/>
                                                        </StackPanel>
                                                        <StackPanel>
                                                            <TextBlock Text="Minimum" FontSize="11" Foreground="Gray"/>
                                                            <TextBlock Text="{Binding Minimum, StringFormat=\{0:0.00\}}" FontWeight="SemiBold"/>
                                                        </StackPanel>
                                                        <StackPanel>
                                                            <TextBlock Text="Maximum" FontSize="11" Foreground="Gray"/>
                                                            <TextBlock Text="{Binding Maximum, StringFormat=\{0:0.00\}}" FontWeight="SemiBold"/>
                                                        </StackPanel>
                                                    </UniformGrid>
                                                    <TextBlock Text="{Binding LastTimestamp, StringFormat=\{0:HH:mm:ss\}}" FontSize="11" Foreground="Gray" HorizontalAlignment="Right"/>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>
                    </Border>

                    <GridSplitter Grid.Column="1" Background="{DynamicResource ThemeControlHighBrush}" HorizontalAlignment="Stretch"/>

                    <Border Grid.Column="2" Background="{DynamicResource ThemeBackgroundBrush}" Margin="0,0,12,12" CornerRadius="12" Padding="0">
                        <controls:TimelineView DataContext="{Binding}"/>
                    </Border>
                </Grid>
            </TabItem>
            <TabItem Header="Activities">
                <controls:ActivityView DataContext="{Binding}"/>
            </TabItem>
            <TabItem Header="Flame Charts">
                <TabControl Margin="0,0,0,12" Padding="0" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch" TabStripPlacement="Left">
                    <TabItem Header="Overview">
                        <Border Margin="12" Padding="12" Background="{DynamicResource ThemeControlLowBrush}" CornerRadius="12">
                            <viz:MasterFlameChartControl Series="{Binding Series}" Activities="{Binding Activities}" VisibleDurationSeconds="{Binding VisibleDurationSeconds}"/>
                        </Border>
                    </TabItem>
                    <TabItem Header="Rendering">
                        <Border Margin="12" Padding="12" Background="{DynamicResource ThemeControlLowBrush}" CornerRadius="12">
                            <viz:FlameChartControl Definition="{x:Static viz:FlameChartDefinitions.Rendering}" Series="{Binding Series}" Activities="{Binding Activities}" VisibleDurationSeconds="{Binding VisibleDurationSeconds}"/>
                        </Border>
                    </TabItem>
                    <TabItem Header="Layout">
                        <Border Margin="12" Padding="12" Background="{DynamicResource ThemeControlLowBrush}" CornerRadius="12">
                            <viz:FlameChartControl Definition="{x:Static viz:FlameChartDefinitions.Layout}" Series="{Binding Series}" Activities="{Binding Activities}" VisibleDurationSeconds="{Binding VisibleDurationSeconds}"/>
                        </Border>
                    </TabItem>
                    <TabItem Header="Input">
                        <Border Margin="12" Padding="12" Background="{DynamicResource ThemeControlLowBrush}" CornerRadius="12">
                            <viz:FlameChartControl Definition="{x:Static viz:FlameChartDefinitions.Input}" Series="{Binding Series}" Activities="{Binding Activities}" VisibleDurationSeconds="{Binding VisibleDurationSeconds}"/>
                        </Border>
                    </TabItem>
                    <TabItem Header="Resources">
                        <Border Margin="12" Padding="12" Background="{DynamicResource ThemeControlLowBrush}" CornerRadius="12">
                            <viz:FlameChartControl Definition="{x:Static viz:FlameChartDefinitions.Resources}" Series="{Binding Series}" Activities="{Binding Activities}" VisibleDurationSeconds="{Binding VisibleDurationSeconds}"/>
                        </Border>
                    </TabItem>
                </TabControl>
            </TabItem>
        </TabControl>
    </DockPanel>
</Window>
